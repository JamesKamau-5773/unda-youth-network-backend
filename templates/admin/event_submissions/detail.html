{% extends "admin/base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-black text-[#0B1E3B] tracking-tight">Submission Details</h1>
      <p class="text-[#006064] font-bold text-sm mt-1">
        Review submission details and take action.
      </p>
    </div>
    <div>
        <a href="{{ url_for('admin.event_submissions_list') }}" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold text-[#00838F] bg-white border border-[#D6EAFC] hover:bg-[#ECF5FF] transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Back to List
        </a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      
      <!-- Event Info Card -->
      <div class="bg-white rounded-[2rem] border border-[#D6EAFC] shadow-sm overflow-hidden">
        <div class="px-8 py-6 border-b border-[#D6EAFC] flex flex-wrap items-center justify-between bg-[#F8FBFF]">
            <h2 class="text-xl font-bold text-[#0B1E3B]">{{ submission.title }}</h2>
             <div>
              {% if submission.submission_status == 'Pending Approval' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-amber-50 text-amber-700 border border-amber-100">Pending Review</span>
              {% elif submission.submission_status == 'Approved' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-emerald-50 text-emerald-700 border border-emerald-100">Approved</span>
              {% elif submission.submission_status == 'Rejected' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-red-50 text-red-700 border border-red-100">Rejected</span>
              {% endif %}
            </div>
        </div>
        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-2">Event Type</h3>
                    <span class="inline-flex items-center px-3 py-1 rounded-lg text-sm font-bold bg-blue-50 text-blue-700 border border-blue-100">
                        {{ submission.event_type }}
                    </span>
                </div>
                 <div>
                    <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-2">Event Date</h3>
                    <div class="flex items-center gap-2 text-[#0B1E3B] font-bold">
                        <svg class="w-5 h-5 text-[#00ACC1]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                         {% if submission.event_date %}
                            {{ submission.event_date.strftime('%A, %d %B %Y at %H:%M') }}
                        {% else %}
                            N/A
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                 <div>
                    <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-2">Location</h3>
                     <div class="flex items-center gap-2 text-[#0B1E3B] font-medium">
                        <svg class="w-5 h-5 text-[#00ACC1]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        {{ submission.location or 'Not specified' }}
                    </div>
                </div>
                 <div>
                    <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-2">Max Participants</h3>
                     <div class="flex items-center gap-2 text-[#0B1E3B] font-medium">
                        <svg class="w-5 h-5 text-[#00ACC1]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        {{ submission.max_participants or 'Not specified' }}
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-3">Description</h3>
                <div class="p-6 bg-[#F8FBFF] rounded-xl border border-[#D6EAFC] text-[#4B5563] leading-relaxed">
                    {{ submission.description }}
                </div>
            </div>

            {% if submission.motion %}
             <div class="mb-8">
                <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-3">Motion/Topic</h3>
                 <div class="p-6 bg-[#F8FBFF] rounded-xl border border-[#D6EAFC] text-[#4B5563] leading-relaxed italic">
                    {{ submission.motion }}
                </div>
            </div>
            {% endif %}

            <div class="border-t border-[#D6EAFC] pt-6 flex flex-wrap gap-8 text-sm">
                <div>
                     <span class="text-[#006064] font-bold">Submitted:</span>
                     <span class="text-[#4B5563] ml-1">{{ submission.created_at.strftime('%d %b %Y at %H:%M') }}</span>
                </div>
                {% if submission.reviewed_at %}
                  <div>
                     <span class="text-[#006064] font-bold">Reviewed:</span>
                     <span class="text-[#4B5563] ml-1">{{ submission.reviewed_at.strftime('%d %b %Y at %H:%M') }}</span>
                </div>
                {% endif %}
            </div>
        </div>
      </div>

       {% if submission.rejection_reason %}
        <div class="bg-red-50 rounded-[2rem] border border-red-100 p-6 flex gap-4">
            <div class="flex-shrink-0">
                 <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
            </div>
            <div>
                 <h3 class="text-red-800 font-bold mb-1">Rejection Reason</h3>
                 <p class="text-red-700">{{ submission.rejection_reason }}</p>
            </div>
        </div>
      {% endif %}

    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
        
       <!-- Submitter Info -->
       <div class="bg-white rounded-[2rem] border border-[#D6EAFC] shadow-sm p-6">
            <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-4 border-b border-[#D6EAFC] pb-2">Submitter Information</h3>
            
            <div class="flex items-center gap-4 mb-4">
                 <div class="h-12 w-12 rounded-full bg-[#E0F7FA] text-[#006064] flex items-center justify-center text-lg font-bold ring-4 ring-[#F0F9FF]">
                    {% if submitter and submitter.full_name %}
                        {{ submitter.full_name[:2].upper() }}
                    {% else %}
                        U
                    {% endif %}
                </div>
                <div>
                     <div class="font-bold text-[#0B1E3B]">
                        {% if submitter %}
                            {{ submitter.full_name }}
                        {% else %}
                            User #{{ submission.submitted_by }}
                        {% endif %}
                     </div>
                     <div class="text-sm text-[#006064]">Member</div>
                </div>
            </div>

            {% if submitter %}
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                         <span class="text-[#64748B]">Email:</span>
                         <span class="text-[#0B1E3B] font-medium text-right">{{ submitter.email }}</span>
                    </div>
                     <div class="flex justify-between">
                         <span class="text-[#64748B]">Phone:</span>
                         <span class="text-[#0B1E3B] font-medium text-right">{{ submitter.phone_number or 'N/A' }}</span>
                    </div>
                    <!-- You can add more submitter details here if available -->
                </div>
            {% else %}
                 <p class="text-sm text-gray-500 italic">Submitter details not available.</p>
            {% endif %}
       </div>

       <!-- Actions -->
       {% if submission.submission_status == 'Pending Approval' %}
       <div class="bg-white rounded-[2rem] border border-[#D6EAFC] shadow-sm p-6">
            <h3 class="text-xs font-bold text-[#006064] uppercase tracking-wider mb-4 border-b border-[#D6EAFC] pb-2">Review Action</h3>
            <p class="text-xs text-[#006064] mb-4">
                This submission is pending review. You can approve it to make it public or reject it with a reason.
            </p>

            <form action="{{ url_for('admin.approve_event_submission', event_id=submission.event_id) }}" method="POST" class="mb-3">
                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                 <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl text-sm font-bold text-white bg-[#10B981] hover:bg-[#059669] transition-all transform hover:-translate-y-0.5 shadow-lg shadow-green-200">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    Approve Submission
                </button>
            </form>

             <button type="button" onclick="document.getElementById('rejectForm').classList.toggle('hidden')" class="w-full inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl text-sm font-bold text-[#B91C1C] bg-red-50 hover:bg-red-100 border border-red-100 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                Reject Submission
            </button>

            <div id="rejectForm" class="hidden mt-4 pt-4 border-t border-[#D6EAFC]">
                 <form action="{{ url_for('admin.reject_event_submission', event_id=submission.event_id) }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                     <label class="block text-xs font-bold text-[#006064] uppercase tracking-wider mb-2">Reason for Rejection</label>
                    <textarea name="rejection_reason" rows="3" required class="w-full px-4 py-3 rounded-xl bg-[#F8FBFF] border border-[#D6EAFC] focus:border-[#00ACC1] focus:ring-1 focus:ring-[#00ACC1] outline-none text-[#0B1E3B] text-sm mb-3" placeholder="Please provide a reason..."></textarea>
                     <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-xl text-sm font-bold text-white bg-[#EF4444] hover:bg-[#DC2626] transition-colors">
                        Confirm Rejection
                    </button>
                 </form>
            </div>
       </div>
       {% endif %}

    </div>
  </div>
</div>
{% endblock %}
