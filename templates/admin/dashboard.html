{% extends "base.html" %}

{% block title %}Admin Dashboard - Unda Youth Network{% endblock %}

{% block content %}
<!-- Modern Header with Gradient -->
<div class="hero-card">
    <div class="hero-card__inner">
        <div>
            <h1 class="hero-card__title">Welcome back, {{ current_user.username }}</h1>
            <p class="hero-card__subtitle">Here's what's happening with your network today</p>
        </div>
        <div class="hero-card__actions">
            {% set ns = namespace(i=0) %}
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.create_champion') }}" class="btn btn--cta btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Prevention Advocate
            </a>
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.podcasts') }}" class="btn btn--secondary btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M9 18V5l12-2v13M9 18l-7 2V7l7-2m0 13c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm12-2c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"/>
                </svg>
                Manage Podcasts
            </a>
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.workstreams') }}" class="btn btn--secondary btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <rect x="3" y="4" width="7" height="7"></rect>
                    <rect x="14" y="4" width="7" height="7"></rect>
                    <rect x="3" y="13" width="7" height="7"></rect>
                    <rect x="14" y="13" width="7" height="7"></rect>
                </svg>
                Workstreams
            </a>
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.affirmations') }}" class="btn btn--secondary btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
                Daily Affirmations
            </a>
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.symbolic_items') }}" class="btn btn--secondary btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                   <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                </svg>
                Symbolic Items
            </a>
            {% if ns.i < 3 %}{% set ns.i = ns.i + 1 %}
            <a href="{{ url_for('admin.manage_users') }}" class="btn btn--secondary btn--nowrap btn--block">
            {% endif %}
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"></path>
                </svg>
                Manage Users
            </a>
        </div>
    </div>
</div>

<!-- Pending Approvals Notifications -->
{% if pending_registrations_count > 0 or pending_applications_count > 0 %}
<div class="mb-lg">
    <div class="grid grid--2-col" style="gap: 1rem;">
        {% if pending_registrations_count > 0 %}
        <a href="{{ url_for('admin.registrations', status='Pending') }}" style="text-decoration: none;">
            <div class="tile" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; transition: transform 0.2s; cursor: pointer;">
                <div class="tile__header" style="align-items: center; gap: 1rem;">
                    <div style="background: #f59e0b; padding: 0.75rem; border-radius: 12px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <path d="M20 8v6M23 11h-6"></path>
                        </svg>
                    </div>
                    <div style="flex: 1;">
                        <div class="tile__value" style="color: #92400e; font-size: 2rem;">{{ pending_registrations_count }}</div>
                        <div class="tile__label" style="color: #b45309;">Pending Member Registration{{ 's' if pending_registrations_count > 1 else '' }}</div>
                        <div style="margin-top: 0.5rem; color: #d97706; font-size: 0.875rem; font-weight: 500;">Click to review →</div>
                    </div>
                </div>
            </div>
        </a>
        {% endif %}
        
        {% if pending_applications_count > 0 %}
        <a href="{{ url_for('admin.champion_applications', status='Pending') }}" style="text-decoration: none;">
            <div class="tile" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 4px solid #3b82f6; transition: transform 0.2s; cursor: pointer;">
                <div class="tile__header" style="align-items: center; gap: 1rem;">
                    <div style="background: #3b82f6; padding: 0.75rem; border-radius: 12px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <polyline points="17 11 19 13 23 9"></polyline>
                        </svg>
                    </div>
                    <div style="flex: 1;">
                        <div class="tile__value" style="color: #1e3a8a; font-size: 2rem;">{{ pending_applications_count }}</div>
                        <div class="tile__label" style="color: #1e40af;">Pending Advocate Application{{ 's' if pending_applications_count > 1 else '' }}</div>
                        <div style="margin-top: 0.5rem; color: #2563eb; font-size: 0.875rem; font-weight: 500;">Click to review →</div>
                    </div>
                </div>
            </div>
        </a>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- CRITICAL ALERTS - Modern Design -->
{% if high_risk_count > 0 or overdue_count > 0 %}
<div class="mb-xl">
    <div class="grid-auto grid-auto--tight">
        {% if high_risk_count > 0 %}
        <div class="tile" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-left: 4px solid #dc2626; box-shadow: 0 4px 16px rgba(220, 38, 38, 0.1);">
            <div class="tile__header" style="align-items: flex-start; gap: 1rem;">
                <div style="background: #dc2626; padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <div style="flex: 1;">
                    <div class="pill" style="color: #991b1b; background: rgba(153, 27, 27, 0.1);">Critical Alert</div>
                    <div class="tile__value" style="color: #7f1d1d; font-size: 2rem;">{{ high_risk_count }}</div>
                    <div class="tile__label" style="color: #991b1b;">High-risk advocates need immediate attention</div>
                </div>
            </div>
            {% if high_risk_champions %}
            <div class="mt-md" style="padding-top: 1rem; border-top: 1px solid rgba(127, 29, 29, 0.2);">
                <div class="tile__label" style="color: #991b1b;">Action Required:</div>
                <ul style="margin: 0; padding-left: 1.25rem; color: #7f1d1d; font-size: 0.875rem; line-height: 1.8;">
                    {% for champion in high_risk_champions[:3] %}
                    <li><strong>{{ champion.full_name }}</strong> ({{ champion.assigned_champion_code }})</li>
                    {% endfor %}
                    {% if high_risk_champions|length > 3 %}
                    <li style="color: #991b1b; font-style: italic;">+{{ high_risk_champions|length - 3 }} more</li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if overdue_count > 0 %}
        <div class="tile" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; box-shadow: 0 4px 16px rgba(245, 158, 11, 0.1);">
            <div class="tile__header" style="align-items: flex-start; gap: 1rem;">
                <div style="background: #f59e0b; padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </div>
                <div style="flex: 1;">
                    <div class="pill" style="color: #92400e; background: rgba(146, 64, 14, 0.1);">Overdue</div>
                    <div class="tile__value" style="color: #78350f; font-size: 2rem;">{{ overdue_count }}</div>
                    <div class="tile__label" style="color: #92400e;">Reviews past due date</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}


<!-- Prevention Advocate Overview - Modern Cards -->
<div class="section-header section-header--spacious">
    <h2 class="section-title">Prevention Advocate Overview</h2>
</div>

<!-- Workstreams Quick Access Cards -->
{# Frequent pages personalization: show up to 3 frequently visited admin pages for the current user #}
{% set frequent_pages = (current_user.frequent_pages or []) if current_user.is_authenticated else [] %}

{% if frequent_pages %}
<div class="section-header section-header--spacious">
    <h2 class="section-title">Quick Access</h2>
    <p class="section-subtitle">Your frequently visited pages</p>
</div>
<div class="grid grid--3-col" style="margin-bottom: 1.5rem; gap: 1rem;">
    {% for p in frequent_pages[:3] %}
    <div class="tile" style="padding: 1rem; display:flex; flex-direction:column; justify-content:space-between;">
        <div>
            <div style="font-size: 0.875rem; color: #374151; font-weight:700;">{{ p.name }}</div>
            <div style="color: #6b7280; margin-top:0.5rem;">Last visited: {{ p.last_seen.split('T')[0] if p.last_seen else '' }}</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem;">
            <div style="font-size:1.25rem; font-weight:700; color:#111827;">{{ p.count }}</div>
            <div>
                {% if p.endpoint %}
                <a href="{{ url_for(p.endpoint) }}" class="btn btn--secondary">Open</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Workstreams Quick Access Cards -->
{% if workstreams_preview %}
<div class="section-header section-header--spacious">
    <h2 class="section-title">Workstreams</h2>
    <p class="section-subtitle">Quick access to key content areas</p>
</div>
<div class="grid grid--3-col" style="margin-bottom: 1.5rem; gap: 1rem;">
    {% for ws in workstreams_preview %}
    <div class="tile" style="padding: 1rem; display:flex; flex-direction:column; justify-content:space-between;">
        <div>
            <div style="font-size: 0.875rem; color: #374151; font-weight:700;">{{ ws.name }}</div>
            <div style="color: #6b7280; margin-top:0.5rem;">{{ ws.description if ws.description is defined else '' }}</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem;">
            <div style="font-size:1.25rem; font-weight:700; color:#111827;">{{ ws.count }}</div>
            <div>
                <a href="{{ url_for(ws.route) }}" class="btn btn--secondary">View</a>
                {% if ws.create_route %}
                <a href="{{ url_for(ws.create_route) }}" class="btn btn--cta">Add New</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="grid-auto" style="margin-bottom: 2.5rem;">
    <!-- Active Advocates - Modern Card -->
    <div class="tile" style="border-left: 4px solid #10b981;">
        <div class="tile__header">
            <div style="background: linear-gradient(135deg, #10b981, #059669); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(16,185,129,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"></path>
                </svg>
            </div>
            <span class="pill" style="background: #d1fae5; color: #065f46;">ACTIVE</span>
        </div>
        <div class="tile__label">Active Advocates</div>
        <div class="tile__value">{{ active_champions }}</div>
        <div class="tile__label">Currently supporting youth</div>
    </div>

    <!-- Inactive Advocates -->
    <div class="tile" style="border-left: 4px solid #ef4444;">
        <div class="tile__header">
            <div style="background: linear-gradient(135deg, #ef4444, #dc2626); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(239,68,68,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
            <span class="pill" style="background: #fee2e2; color: #991b1b;">INACTIVE</span>
        </div>
        <div class="tile__label">Inactive Advocates</div>
        <div class="tile__value">{{ inactive_champions }}</div>
        <div class="tile__label">Require re-engagement</div>
    </div>

    <!-- On Hold Champions -->
    <div class="tile" style="border-left: 4px solid #f59e0b;">
        <div class="tile__header">
            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(245,158,11,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="10" y1="15" x2="10" y2="9"></line>
                    <line x1="14" y1="15" x2="14" y2="9"></line>
                </svg>
            </div>
            <span class="pill" style="background: #fef3c7; color: #92400e;">ON HOLD</span>
        </div>
        <div class="tile__label">On Hold</div>
        <div class="tile__value">{{ on_hold_champions }}</div>
        <div class="tile__label">Pending review/action</div>
    </div>

    <!-- Screening Completion -->
    <div class="tile" style="border-left: 4px solid #3b82f6;">
        <div class="tile__header">
            <div style="background: linear-gradient(135deg, #3b82f6, #2563eb); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(59,130,246,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <span class="pill" style="background: #dbeafe; color: #1e40af;">{{ avg_screening_completion_rate }}%</span>
        </div>
        <div class="tile__label">Screening Completion</div>
        <div style="background: #f1f5f9; border-radius: 8px; height: 8px; margin-bottom: 0.75rem; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #3b82f6, #2563eb); height: 100%; width: {{ avg_screening_completion_rate }}%;"></div>
        </div>
        <div class="tile__label">Background checks complete</div>
    </div>
</div>

<!-- Key Performance Indicators - Modern Grid -->
<div style="margin-bottom: 1.5rem;">
    <h2 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1.5rem;">Performance Metrics</h2>
</div>

<div class="grid-auto" style="margin-bottom: 2.5rem;">
    <!-- Check-In Completion -->
    <div style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(139,92,246,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Check-In Completion</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.75rem;">{{ avg_check_in }}<span style="font-size: 1.25rem; color: #94a3b8;">%</span></div>
        <div style="background: #f1f5f9; border-radius: 8px; height: 6px; margin-bottom: 0.5rem; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #8b5cf6, #7c3aed); height: 100%; width: {{ avg_check_in }}%; transition: width 1s ease;"></div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem;">Weekly youth check-ins</div>
    </div>
    
    <!-- Referral Conversion -->
    <div style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #06b6d4, #0891b2); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(6,182,212,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <polyline points="17 11 19 13 23 9"></polyline>
                </svg>
            </div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Referral Conversion</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.75rem;">{{ conversion_rate }}<span style="font-size: 1.25rem; color: #94a3b8;">%</span></div>
        <div style="background: #f1f5f9; border-radius: 8px; height: 6px; margin-bottom: 0.5rem; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #06b6d4, #0891b2); height: 100%; width: {{ conversion_rate }}%; transition: width 1s ease;"></div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem;">Flags to professional care</div>
    </div>
    
    <!-- Training Compliance -->
    <div style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #ec4899, #db2777); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(236,72,153,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                    <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                </svg>
            </div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Training Compliance</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.75rem;">{{ training_compliance_rate }}<span style="font-size: 1.25rem; color: #94a3b8;">%</span></div>
        <div style="background: #f1f5f9; border-radius: 8px; height: 6px; margin-bottom: 0.5rem; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #ec4899, #db2777); height: 100%; width: {{ training_compliance_rate }}%; transition: width 1s ease;"></div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem;">{{ champions_with_core_training }}/{{ total_champions }} certified</div>
    </div>

    <!-- Youth Satisfaction -->
    <div style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(245,158,11,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                </svg>
            </div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Youth Satisfaction</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">{{ quarterly_satisfaction }}<span style="font-size: 1.25rem; color: #94a3b8;">/10</span></div>
        <div style="color: #64748b; font-size: 0.875rem;">Quarterly wellbeing score</div>
    </div>
    
    <!-- Response Time -->
    <div style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #14b8a6, #0d9488); padding: 0.75rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(20,184,166,0.3);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
        </div>
        <div style="color: #64748b; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Response Time</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">{{ avg_flag_to_referral }}<span style="font-size: 1.25rem; color: #94a3b8;"> days</span></div>
        <div style="color: #64748b; font-size: 0.875rem;">Flag to referral</div>
    </div>
    
    <!-- Total Youth Reached -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 1.5rem; box-shadow: 0 8px 24px rgba(102,126,234,0.2); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 12px 32px rgba(102,126,234,0.3)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 8px 24px rgba(102,126,234,0.2)'; this.style.transform='translateY(0)'">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 0.75rem; border-radius: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 00-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 010 7.75"></path>
                </svg>
            </div>
        </div>
        <div style="color: rgba(255,255,255,0.9); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Total Youth Reached</div>
        <div style="font-size: 2.25rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">{{ total_youth_reached }}</div>
        <div style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Across all champions</div>
    </div>
</div>

<!-- Prevention Advocate Performance -->
<div style="margin-bottom: 1rem;">
    <h2 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">Prevention Advocate Performance</h2>
    <p style="color: #64748b; font-size: 0.875rem;">Youth reach and engagement metrics</p>
</div>

<div class="tile">
    {% if youth_per_champion|length == 0 %}
    <div style="text-align: center; padding: 3rem 1rem;">
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); margin: 0 auto 1.5rem; width: 80px; height: 80px; border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(102,126,234,0.3);">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"></path>
            </svg>
        </div>
        <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.75rem;">No Prevention Advocates Yet</div>
        <div style="color: #64748b; margin-bottom: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto;">
            Start building your network by registering prevention advocates who will support youth in their communities.
        </div>
        <a href="{{ url_for('admin.create_champion') }}" class="btn btn--cta btn--block btn--nowrap">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Register First Prevention Advocate
        </a>
    </div>
    {% else %}
    <div class="data-table-wrapper">
        <table class="data-table table-stack">
            <thead>
                <tr>
                    <th>Advocate Code</th>
                    <th>Full Name</th>
                    <th class="text-right">Youth Reached</th>
                </tr>
            </thead>
            <tbody>
                {% for champion in youth_per_champion %}
                <tr>
                    <td data-label="Advocate Code">
                        <span class="badge badge--primary">{{ champion.assigned_champion_code }}</span>
                    </td>
                    <td data-label="Full Name" class="font-medium">{{ champion.full_name }}</td>
                    <td data-label="Youth Reached" class="table-cell--numeric">
                        <span class="badge" style="background: #f1f5f9; color: #1e293b; font-weight: 700; font-size: 1rem;">{{ champion.total_youth }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>

<!-- Recruitment Analytics -->
<div style="margin-bottom: 1rem;">
    <h2 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">Recruitment Analytics</h2>
    <p style="color: #64748b; font-size: 0.875rem;">Prevention Advocate sources and acquisition channels</p>
</div>

<div class="tile">
    <div class="data-table-wrapper">
        <table class="data-table table-stack">
            <thead>
                <tr>
                    <th>Recruitment Source</th>
                    <th class="text-right">Champions</th>
                    <th class="text-right">Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% set total_sources = recruitment_sources | sum(attribute='count') %}
                {% for source in recruitment_sources %}
                <tr>
                    <td data-label="Recruitment Source" class="font-medium">{{ source.recruitment_source or 'Not Specified' }}</td>
                    <td data-label="Prevention Advocates" class="table-cell--numeric">
                        <span class="badge" style="background: #f1f5f9; color: #1e293b; font-weight: 700;">{{ source.count }}</span>
                    </td>
                    <td data-label="Percentage" class="table-cell--numeric">
                        <div style="display: flex; align-items: center; justify-content: flex-end; gap: 0.75rem;">
                            <div style="flex: 0 0 100px; background: #f1f5f9; border-radius: 8px; height: 8px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: {{ ((source.count / total_sources * 100) | round(1)) }}%;"></div>
                            </div>
                            <span style="color: #64748b; font-weight: 600; min-width: 50px;">{{ ((source.count / total_sources * 100) | round(1)) }}%</span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Compliance Monitoring -->
<div class="section-header">
    <h2 class="section-title">Compliance Monitoring</h2>
    <p class="section-subtitle">Consent and training status overview</p>
</div>

<div class="grid-auto">
    <div style="background: {% if champions_missing_consent > 0 %}linear-gradient(135deg, #fef3c7 0%, #fde68a 100%){% else %}linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%){% endif %}; border-radius: 16px; padding: 1.5rem; border-left: 4px solid {% if champions_missing_consent > 0 %}#f59e0b{% else %}#10b981{% endif %}; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <div style="background: {% if champions_missing_consent > 0 %}rgba(245,158,11,0.2){% else %}rgba(16,185,129,0.2){% endif %}; padding: 0.625rem; border-radius: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="{% if champions_missing_consent > 0 %}#f59e0b{% else %}#10b981{% endif %}" stroke-width="2">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <span style="color: #1e293b; font-weight: 600; font-size: 1rem;">Personal Consent</span>
        </div>
        <div style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">{{ champions_missing_consent }}</div>
        <div style="color: #64748b; font-size: 0.875rem;">Champions missing consent</div>
        {% if champions_missing_consent == 0 %}
        <div style="background: rgba(16,185,129,0.15); color: #059669; padding: 0.5rem; border-radius: 8px; margin-top: 0.75rem; font-size: 0.875rem; font-weight: 600; text-align: center;">Fully Compliant</div>
        {% endif %}
    </div>
    
    <div style="background: {% if champions_missing_institution > 0 %}linear-gradient(135deg, #fef3c7 0%, #fde68a 100%){% else %}linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%){% endif %}; border-radius: 16px; padding: 1.5rem; border-left: 4px solid {% if champions_missing_institution > 0 %}#f59e0b{% else %}#10b981{% endif %}; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <div style="background: {% if champions_missing_institution > 0 %}rgba(245,158,11,0.2){% else %}rgba(16,185,129,0.2){% endif %}; padding: 0.625rem; border-radius: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="{% if champions_missing_institution > 0 %}#f59e0b{% else %}#10b981{% endif %}" stroke-width="2">
                    <path d="M3 21h18M3 10h18M3 7l9-4 9 4M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"></path>
                </svg>
            </div>
            <span style="color: #1e293b; font-weight: 600; font-size: 1rem;">Institution Consent</span>
        </div>
        <div style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">{{ champions_missing_institution }}</div>
        <div style="color: #64748b; font-size: 0.875rem;">Champions missing consent</div>
        {% if champions_missing_institution == 0 %}
        <div style="background: rgba(16,185,129,0.15); color: #059669; padding: 0.5rem; border-radius: 8px; margin-top: 0.75rem; font-size: 0.875rem; font-weight: 600; text-align: center;">Fully Compliant</div>
        {% endif %}
    </div>
</div>

<!-- Training Refreshers -->
<div style="margin-bottom: 1rem;">
    <h2 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">Training Refreshers</h2>
    <p style="color: #64748b; font-size: 0.875rem;">Upcoming training renewals (next 30 days)</p>
</div>

<div class="tile">
    {% if upcoming_refreshers %}
    <div class="data-table-wrapper">
        <table class="data-table table-stack">
            <thead>
                <tr>
                    <th>Champion</th>
                    <th>Training Module</th>
                    <th class="text-right">Due Date</th>
                </tr>
            </thead>
            <tbody>
                {% for champion, training in upcoming_refreshers %}
                <tr>
                    <td data-label="Prevention Advocate">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem;">{{ champion.full_name[0] }}</div>
                            <div>
                                <div class="font-medium" style="color: #1e293b;">{{ champion.full_name }}</div>
                                <span class="badge" style="background: #f1f5f9; color: #64748b;">{{ champion.assigned_champion_code }}</span>
                            </div>
                        </div>
                    </td>
                    <td data-label="Training Module" class="font-medium">{{ training.training_module }}</td>
                    <td data-label="Due Date" class="table-cell--numeric">
                        <span class="badge" style="background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; border-left: 3px solid #f59e0b;">{{ training.next_refresher_due_date.strftime('%Y-%m-%d') }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 2rem 1rem;">
        <div style="background: linear-gradient(135deg, #10b981, #059669); margin: 0 auto 1rem; width: 64px; height: 64px; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(16,185,129,0.3);">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <p style="color: #64748b; font-size: 0.875rem;">All champions are up to date with their training refreshers</p>
    </div>
    {% endif %}
</div>

<!-- Program Summary -->
<div style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border-radius: 16px; padding: 2.5rem; margin-top: 2rem; box-shadow: 0 8px 24px rgba(30,41,59,0.15);">
    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
        <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 0.75rem; border-radius: 12px;">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        </div>
        <h3 style="font-size: 1.5rem; font-weight: 700; color: white; margin: 0;">Data Safe Environment</h3>
    </div>
    <p style="color: rgba(255,255,255,0.8); font-size: 0.9375rem; line-height: 1.6; margin-bottom: 2rem;">The Unda Youth Network operates within a secure, privacy-compliant framework that protects sensitive adolescent information while demonstrating measurable program impact to donors and clinical partners.</p>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
        <div style="text-align: center; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="color: rgba(255,255,255,0.7); font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Total Champions</div>
            <div style="color: white; font-size: 2.5rem; font-weight: 700;">{{ total_champions }}</div>
        </div>
        <div style="text-align: center; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="color: rgba(255,255,255,0.7); font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Avg Response Time</div>
            <div style="color: white; font-size: 2.5rem; font-weight: 700;">{{ avg_flag_to_referral }}<span style="font-size: 1.25rem; font-weight: 400;"> days</span></div>
        </div>
    </div>
</div>

<script>
// Real-time notifications polling
function updatePendingCounts() {
    fetch('/admin/api/pending-counts')
        .then(response => response.json())
        .then(data => {
            const regValue = document.querySelector('[href*="registrations"] .tile__value');
            const appValue = document.querySelector('[href*="champion-applications"] .tile__value');
            
            if (regValue && data.registrations !== undefined) {
                regValue.textContent = data.registrations;
            }
            if (appValue && data.applications !== undefined) {
                appValue.textContent = data.applications;
            }
            
            // Show/hide notification cards based on counts
            const regCard = document.querySelector('[href*="registrations"]');
            const appCard = document.querySelector('[href*="champion-applications"]');
            const notificationSection = document.querySelector('.mb-lg');
            
            if (regCard && data.registrations === 0) {
                regCard.style.display = 'none';
            } else if (regCard) {
                regCard.style.display = '';
            }
            
            if (appCard && data.applications === 0) {
                appCard.style.display = 'none';
            } else if (appCard) {
                appCard.style.display = '';
            }
            
            // Hide entire section if both counts are zero
            if (notificationSection && data.registrations === 0 && data.applications === 0) {
                notificationSection.style.display = 'none';
            } else if (notificationSection) {
                notificationSection.style.display = '';
            }
        })
        .catch(error => console.error('Error fetching pending counts:', error));
}

// Poll every 30 seconds
setInterval(updatePendingCounts, 30000);

// Add hover effect
document.querySelectorAll('[href*="registrations"], [href*="champion-applications"]').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.querySelector('.tile').style.transform = 'translateY(-4px)';
        this.querySelector('.tile').style.boxShadow = '0 12px 24px rgba(0,0,0,0.15)';
    });
    card.addEventListener('mouseleave', function() {
        this.querySelector('.tile').style.transform = 'translateY(0)';
        this.querySelector('.tile').style.boxShadow = '';
    });
});
</script>

{% endblock %}
