{% extends "admin/base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">

  {# Page Header #}
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-black text-[#0B1E3B] tracking-tight">
        UMV Mtaani
      </h1>
      <p class="text-[#006064] font-bold text-sm mt-1">
        Manage community barazas and grassroots engagement.
      </p>
    </div>
    
    <div class="flex gap-3">
        {# Back Button #}
          <a href="{{ url_for('admin.workstreams') }}" 
            class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold text-[#00838F] bg-white border border-[#D6EAFC] hover:bg-[#ECF5FF] transition-colors">
           <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
           Back
        </a>
        
        {# Create Button #}
        <a href="{{ url_for('admin.create_mtaani_event') }}" 
           class="inline-flex items-center justify-center gap-2 px-6 py-2.5 rounded-xl text-sm font-bold text-white bg-[#00838F] hover:bg-[#006064] shadow-lg shadow-[#00838F]/20 transition-transform hover:-translate-y-0.5">
           <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
           New Event
        </a>
    </div>
  </div>

  {# Stats Grid #}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      {# Total Card #}
      <div class="bg-white p-6 rounded-[2rem] border border-[#D6EAFC] shadow-sm flex items-center justify-between">
          <div>
              <p class="text-xs font-bold text-[#00838F] uppercase tracking-wider mb-1">Total Barazas</p>
              <p class="text-3xl font-black text-[#0B1E3B]">{{ stats.total }}</p>
          </div>
          <div class="h-12 w-12 rounded-full bg-[#ECF5FF] flex items-center justify-center text-[#00ACC1]">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
          </div>
      </div>

      {# Upcoming Card #}
      <div class="bg-white p-6 rounded-[2rem] border border-[#D6EAFC] shadow-sm flex items-center justify-between">
          <div>
              <p class="text-xs font-bold text-[#00838F] uppercase tracking-wider mb-1">Upcoming</p>
              <p class="text-3xl font-black text-[#0B1E3B]">{{ stats.upcoming }}</p>
          </div>
          <div class="h-12 w-12 rounded-full bg-[#D6EAFC] flex items-center justify-center text-[#00838F]">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          </div>
      </div>

      {# Completed Card #}
      <div class="bg-white p-6 rounded-[2rem] border border-[#D6EAFC] shadow-sm flex items-center justify-between">
          <div>
              <p class="text-xs font-bold text-[#00838F] uppercase tracking-wider mb-1">Completed</p>
              <p class="text-3xl font-black text-[#0B1E3B]">{{ stats.completed }}</p>
          </div>
          <div class="h-12 w-12 rounded-full bg-[#F0FDF4] flex items-center justify-center text-[#16A34A]">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
          </div>
      </div>
  </div>

  {# Filter Tabs #}
  <div class="flex flex-wrap items-center gap-2 mb-6">
      <span class="text-xs font-bold text-[#006064] uppercase mr-2">Filter By:</span>
      {% for filter_name in ['all', 'Upcoming', 'Ongoing', 'Completed', 'Cancelled'] %}
        <a href="{{ url_for('admin.umv_mtaani', status=filter_name) }}" 
           class="px-4 py-1.5 rounded-full text-xs font-bold transition-all border 
           {{ 'bg-[#00838F] text-white border-[#00838F]' if status_filter == filter_name else 'bg-white text-[#00838F] border-[#D6EAFC] hover:bg-[#ECF5FF] hover:border-[#D6EAFC]' }}">
           {{ filter_name|capitalize }}
        </a>
      {% endfor %}
  </div>

  {# Events List #}
  <div class="bg-white rounded-[2rem] border border-[#D6EAFC] shadow-sm overflow-hidden">
    
    {# Header Row #}
    <div class="hidden md:grid grid-cols-12 px-8 py-4 bg-[#ECF5FF] border-b border-[#D6EAFC] gap-4">
       <div class="col-span-5 text-xs font-bold text-[#006064] uppercase tracking-wider">Event Details</div>
       <div class="col-span-3 text-xs font-bold text-[#006064] uppercase tracking-wider">Date & Time</div>
       <div class="col-span-2 text-xs font-bold text-[#006064] uppercase tracking-wider">Status</div>
       <div class="col-span-2 text-xs font-bold text-[#006064] uppercase tracking-wider text-right">Actions</div>
    </div>

    <div class="divide-y divide-[#D6EAFC]">
      {% if events %}
        {% for event in events %}
        <div class="group grid grid-cols-1 md:grid-cols-12 gap-4 p-6 hover:bg-[#ECF5FF] transition-colors items-center">
            
            {# Column 1: Title & Location #}
            <div class="md:col-span-5">
                <h3 class="text-lg font-bold text-[#0B1E3B] mb-1">{{ event.title }}</h3>
                <div class="flex items-center gap-2 text-sm text-[#006064]">
                    {% if event.location %}
                        <svg class="w-4 h-4 text-[#00ACC1]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        <span>{{ event.location }}</span>
                    {% endif %}
                </div>
            </div>

            {# Column 2: Date #}
            <div class="md:col-span-3">
                <div class="flex items-center gap-2">
                    <div class="h-10 w-10 bg-[#D6EAFC] rounded-xl flex flex-col items-center justify-center text-[#00838F] border border-[#D6EAFC]">
                        <span class="text-[10px] font-bold uppercase">{{ event.event_date.strftime('%b') }}</span>
                        <span class="text-sm font-black leading-none">{{ event.event_date.strftime('%d') }}</span>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-[#0B1E3B]">{{ event.event_date.strftime('%I:%M %p') }}</p>
                        <p class="text-xs text-[#00838F]">{{ event.event_date.strftime('%Y') }}</p>
                    </div>
                </div>
            </div>

            {# Column 3: Status #}
            <div class="md:col-span-2">
                <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-bold uppercase tracking-wide
                    {% if event.status == 'Upcoming' %} bg-blue-50 text-blue-700 border border-blue-100
                    {% elif event.status == 'Completed' %} bg-green-50 text-green-700 border border-green-100
                    {% elif event.status == 'Ongoing' %} bg-amber-50 text-amber-700 border border-amber-100
                    {% else %} bg-gray-50 text-gray-600 border border-gray-100 {% endif %}">
                    {{ event.status }}
                </span>
            </div>

            {# Column 4: Actions #}
            <div class="md:col-span-2 flex items-center justify-end gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity">
                <a href="{{ url_for('admin.edit_mtaani_event', event_id=event.event_id) }}" 
                   class="p-2 rounded-lg text-[#00838F] hover:bg-white hover:text-[#006064] border border-transparent hover:border-[#D6EAFC] transition-all"
                   title="Edit">
                   <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                </a>
                
                <form action="{{ url_for('admin.delete_mtaani_event', event_id=event.event_id) }}" method="post" onsubmit="return confirm('Are you sure?');" style="display:inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button class="p-2 rounded-lg text-red-400 hover:bg-red-50 hover:text-red-600 border border-transparent hover:border-red-100 transition-all" title="Delete">
                       <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </form>
            </div>

        </div>
        {% endfor %}
      {% else %}
        {# Empty State #}
          <div class="p-16 text-center flex flex-col items-center">
            <div class="h-20 w-20 bg-[#ECF5FF] rounded-full flex items-center justify-center mb-4 border border-[#D6EAFC]">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#00838F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
           </div>
           <h3 class="text-[#0B1E3B] font-bold text-xl">No Events Found</h3>
           <p class="text-[#006064] text-sm mt-2 mb-8 font-medium max-w-xs mx-auto">
             There are no events matching your current filter. Create a new one to get started.
           </p>
           <a href="{{ url_for('admin.create_mtaani_event') }}" class="px-8 py-3 rounded-xl text-sm font-bold text-white bg-[#00838F] hover:bg-[#006064] shadow-lg shadow-[#00838F]/20 transition-transform hover:-translate-y-0.5">
             Create First Event
           </a>
        </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}