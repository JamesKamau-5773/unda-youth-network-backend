{% extends "base.html" %}

{% block title %}Manage Advocate Assignments - Admin Dashboard{% endblock %}

{% block content %}
<div class="manage-assignments-page">
<div class="dashboard-header">
    <h1 class="dashboard-title">Manage Advocate-Supervisor Assignments</h1>
    <p class="dashboard-subtitle">Assign prevention advocates to supervisors for mentorship and monitoring</p>
</div>

<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn--secondary">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;" aria-hidden="true">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Admin Dashboard
    </a>
</div>

<!-- Summary Stats -->
<div class="stat-grid" style="margin-bottom: 2rem;">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #00ACC1 0%, #00838F 100%);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 00-3-3.87"></path>
                <path d="M16 3.13a4 4 0 010 7.75"></path>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-value">{{ champions|length }}</p>
            <p class="stat-label">Total Prevention Advocates</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #0B1E3B 0%, #00838F 100%);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <polyline points="17 11 19 13 23 9"></polyline>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-value">{{ supervisors|length }}</p>
            <p class="stat-label">Active Supervisors</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #00838F 0%, #D6EAFC 100%);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-value">{{ unassigned_champions|length }}</p>
            <p class="stat-label">Unassigned Prevention Advocates</p>
        </div>
    </div>
</div>

<!-- Unassigned Champions -->
{% if unassigned_champions %}
<div class="data-card" style="margin-bottom: 2rem;">
    <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); background: #D6EAFC;">
        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0; color: #0B1E3B; display: flex; align-items: center; gap: 0.5rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Unassigned Prevention Advocates ({{ unassigned_champions|length }})
        </h3>
        <p style="font-size: 0.875rem; color: #334e68; margin: 0.25rem 0 0 0;">These advocates need supervisor assignment for proper mentorship</p>
    </div>
    
    <div style="padding: 1.5rem;">
        <div class="table-container">
            <table class="data-table table-stack">
                <thead>
                    <tr>
                        <th>Advocate Code</th>
                        <th>Full Name</th>
                        <th>Username</th>
                        <th>Status</th>
                        <th>Assign to Supervisor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for champion in unassigned_champions %}
                    <tr>
                        <td data-label="Advocate Code"><span class="badge badge--primary">{{ champion.assigned_champion_code }}</span></td>
                        <td data-label="Full Name" class="font-medium">{{ champion.full_name }}</td>
                        <td data-label="Username">{{ champion.username }}</td>
                        <td data-label="Status">
                            <span class="badge {% if champion.champion_status == 'Active' %}badge--unda-active{% else %}badge--unda-inactive{% endif %}">
                                {{ champion.champion_status }}
                            </span>
                        </td>
                        <td data-label="Assign to Supervisor">
                            <form method="POST" action="{{ url_for('admin.assign_champion', champion_id=champion.champion_id) }}" class="table-actions">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <select name="supervisor_id" class="form-input" required>
                                    <option value="">-- Select Supervisor --</option>
                                    {% for supervisor in supervisors %}
                                    <option value="{{ supervisor.user_id }}">{{ supervisor.username }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn btn--primary btn--nowrap">Assign</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Assigned Champions by Supervisor -->
<div class="data-card">
    <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); background: #ECF5FF;">
        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0; color: #0B1E3B;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 00-3-3.87"></path>
                <path d="M16 3.13a4 4 0 010 7.75"></path>
            </svg>
            Assigned Advocates by Supervisor
        </h3>
        <p style="font-size: 0.875rem; color: #627d98; margin: 0.25rem 0 0 0;">View and reassign advocates under each supervisor</p>
    </div>
    
    <div style="padding: 1.5rem;">
        {% if supervisors %}
            {% for supervisor in supervisors %}
            <div style="margin-bottom: 2rem; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: 0.5rem; background: #ECF5FF;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #0B1E3B; margin: 0 0 1rem 0; display: flex; align-items: center; justify-content: space-between;">
                    <span>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        {{ supervisor.username }}
                    </span>
                    <span class="badge badge--unda-info">
                        {{ assigned_champions.get(supervisor.user_id, [])|length }} Advocates
                    </span>
                </h4>
                
                {% if assigned_champions.get(supervisor.user_id) %}
                <div class="table-container">
                    <table class="data-table table-stack">
                        <thead>
                            <tr>
                                <th>Advocate Code</th>
                                <th>Full Name</th>
                                <th>Username</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for champion in assigned_champions.get(supervisor.user_id, []) %}
                            <tr>
                                <td data-label="Advocate Code"><span class="badge badge--primary">{{ champion.assigned_champion_code }}</span></td>
                                <td data-label="Full Name" class="font-medium">{{ champion.full_name }}</td>
                                <td data-label="Username">{{ champion.username }}</td>
                                <td data-label="Status">
                                    <span class="badge {% if champion.champion_status == 'Active' %}badge--unda-active{% else %}badge--unda-inactive{% endif %}">
                                        {{ champion.champion_status }}
                                    </span>
                                </td>
                                <td data-label="Actions">
                                    <form method="POST" action="{{ url_for('admin.assign_champion', champion_id=champion.champion_id) }}" class="table-actions">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <select name="supervisor_id" class="form-input">
                                            <option value="">-- Unassign --</option>
                                            {% for sup in supervisors %}
                                            <option value="{{ sup.user_id }}" {% if sup.user_id == supervisor.user_id %}selected{% endif %}>
                                                {{ sup.username }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <button type="submit" class="btn btn--unda-outline btn--nowrap">Update</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p style="color: #627d98; font-style: italic; margin: 0;">No advocates assigned to this supervisor yet</p>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
        <p style="color: #627d98; font-style: italic;">No supervisors available. Please create supervisor accounts first.</p>
        {% endif %}
    </div>
</div>

</div>

<style>
.manage-assignments-page .btn--secondary {
    background-color: #00ACC1;
    border-color: #00ACC1;
    color: #ECF5FF;
}

.manage-assignments-page .btn--secondary:hover {
    background-color: #00838F;
    border-color: #00838F;
}

.manage-assignments-page .btn--unda-outline {
    background-color: transparent;
    border: 1px solid #00838F;
    color: #00838F;
}

.manage-assignments-page .btn--unda-outline:hover {
    background-color: #E0F7FA;
    border-color: #00838F;
    color: #006064;
}

.manage-assignments-page .badge--unda-active {
    background-color: #E0F7FA;
    color: #00838F;
}

.manage-assignments-page .badge--unda-inactive {
    background-color: #ECF5FF;
    color: #486581;
}

.manage-assignments-page .badge--unda-info {
    background-color: #D6EAFC;
    color: #0B1E3B;
}
</style>

{% endblock %}
