{% extends "base.html" %}

{% block title %}{{ action }} Podcast - Admin Dashboard{% endblock %}

{% block content %}
<div class="hero-card">
    <div class="hero-card__inner">
        <div>
            <h1 class="hero-card__title">{{ action }} Podcast</h1>
            <p class="hero-card__subtitle">{% if podcast %}Edit podcast details{% else %}Add a new podcast episode{% endif %}</p>
        </div>
        <div class="hero-card__actions">
            <a href="{{ url_for('admin.podcasts') }}" class="btn btn--secondary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Podcasts
            </a>
        </div>
    </div>
</div>

<div style="max-width: 800px; margin: 0 auto;">
    <div class="data-card">
        <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
            <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0; color: white; display: flex; align-items: center;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.75rem;">
                    <path d="M9 18V5l12-2v13M9 18l-7 2V7l7-2m0 13c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm12-2c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"/>
                </svg>
                Podcast Details
            </h3>
        </div>
        
        <div style="padding: 2rem;">
            <form method="POST" id="podcastForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <!-- Title -->
                <div class="form-group">
                    <label for="title" class="form-label">Title <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="title" name="title" class="form-input" required 
                           value="{{ podcast.title if podcast else '' }}" 
                           placeholder="Episode title">
                </div>
                
                <!-- Description -->
                <div class="form-group">
                    <label for="description" class="form-label">Description</label>
                    <textarea id="description" name="description" class="form-input" rows="4" 
                              placeholder="Brief description of the podcast episode">{{ podcast.description if podcast else '' }}</textarea>
                </div>
                
                <!-- Guest -->
                <div class="form-group">
                    <label for="guest" class="form-label">Guest</label>
                    <input type="text" id="guest" name="guest" class="form-input" 
                           value="{{ podcast.guest if podcast else '' }}" 
                           placeholder="Guest name(s)">
                    <small style="color: #6b7280; font-size: 0.875rem;">Name of the guest(s) featured in this episode</small>
                </div>
                
                <!-- Audio URL -->
                <div class="form-group">
                    <label for="audio_url" class="form-label">Audio URL <span style="color: #ef4444;">*</span></label>
                    <input type="url" id="audio_url" name="audio_url" class="form-input" required 
                           value="{{ podcast.audio_url if podcast else '' }}" 
                           placeholder="https://example.com/audio.mp3">
                    <small style="color: #6b7280; font-size: 0.875rem;">Direct link to the audio file (MP3, WAV, etc.)</small>
                </div>
                
                <!-- Thumbnail URL -->
                <div class="form-group">
                    <label for="thumbnail_url" class="form-label">Thumbnail URL</label>
                    <input type="url" id="thumbnail_url" name="thumbnail_url" class="form-input" 
                           value="{{ podcast.thumbnail_url if podcast else '' }}" 
                           placeholder="https://example.com/thumbnail.jpg">
                    <small style="color: #6b7280; font-size: 0.875rem;">Optional cover image for the podcast</small>
                </div>
                
                <!-- Episode Details -->
                <div class="grid grid--3-col" style="gap: 1rem;">
                    <div class="form-group">
                        <label for="duration" class="form-label">Duration (seconds)</label>
                        <input type="number" id="duration" name="duration" class="form-input" min="0" 
                               value="{{ podcast.duration if podcast else '' }}" 
                               placeholder="e.g., 1800">
                        <small style="color: #6b7280; font-size: 0.875rem;">Total length in seconds</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="episode_date" class="form-label">Episode Date</label>
                        <input type="datetime-local" id="episode_date" name="episode_date" class="form-input" 
                               value="{{ podcast.episode_date.strftime('%Y-%m-%dT%H:%M') if podcast and podcast.episode_date else '' }}">
                        <small style="color: #6b7280; font-size: 0.875rem;">Date and time of the episode</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="season_number" class="form-label">Season</label>
                        <input type="number" id="season_number" name="season_number" class="form-input" min="1" 
                               value="{{ podcast.season_number if podcast else '' }}" 
                               placeholder="e.g., 1">
                    </div>
                </div>
                
                <!-- Episode Number -->
                <div class="form-group">
                    <label for="episode_number" class="form-label">Episode Number</label>
                    <input type="number" id="episode_number" name="episode_number" class="form-input" min="1" 
                           value="{{ podcast.episode_number if podcast else '' }}" 
                           placeholder="e.g., 1">
                </div>
                
                <!-- Category -->
                <div class="form-group">
                    <label for="category" class="form-label">Category</label>
                    <input type="text" id="category" name="category" class="form-input" 
                           value="{{ podcast.category if podcast else '' }}" 
                           placeholder="e.g., Mental Health, Youth Empowerment" 
                           list="categoryList">
                    <datalist id="categoryList">
                        <option value="Mental Health">
                        <option value="Youth Empowerment">
                        <option value="Community Stories">
                        <option value="Health & Wellness">
                        <option value="Education">
                    </datalist>
                    <small style="color: #6b7280; font-size: 0.875rem;">Helps organize podcasts by topic</small>
                </div>
                
                <!-- Tags -->
                <div class="form-group">
                    <label for="tags" class="form-label">Tags</label>
                    <input type="text" id="tags" name="tags" class="form-input" 
                           value="{{ podcast.tags|join(', ') if podcast and podcast.tags else '' }}" 
                           placeholder="mental health, mindfulness, wellness">
                    <small style="color: #6b7280; font-size: 0.875rem;">Comma-separated tags for searchability</small>
                </div>
                
                <!-- Published Status -->
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                        <input type="checkbox" id="published" name="published" 
                               {% if podcast and podcast.published %}checked{% endif %}
                               style="width: 1.25rem; height: 1.25rem; cursor: pointer;">
                        <span style="font-weight: 600; color: #334155;">Publish this podcast</span>
                    </label>
                    <small style="color: #6b7280; font-size: 0.875rem; display: block; margin-left: 2rem;">
                        Published podcasts will be visible to all users. Unpublished podcasts are saved as drafts.
                    </small>
                </div>
                
                <!-- Submit Buttons -->
                <div style="display: flex; gap: 0.75rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn--primary" style="flex: 1;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        {{ 'Update Podcast' if podcast else 'Create Podcast' }}
                    </button>
                    <a href="{{ url_for('admin.podcasts') }}" class="btn btn--secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Form validation
document.getElementById('podcastForm').addEventListener('submit', function(e) {
    const title = document.getElementById('title').value.trim();
    const audioUrl = document.getElementById('audio_url').value.trim();
    
    if (!title) {
        e.preventDefault();
        alert('Please enter a podcast title');
        return;
    }
    
    if (!audioUrl) {
        e.preventDefault();
        alert('Please enter an audio URL');
        return;
    }
    
    // Validate URL format
    try {
        new URL(audioUrl);
    } catch (err) {
        e.preventDefault();
        alert('Please enter a valid audio URL');
        return;
    }
});

// Auto-calculate duration from audio file (if browser supports it)
document.getElementById('audio_url').addEventListener('blur', function() {
    const url = this.value.trim();
    const durationField = document.getElementById('duration');
    
    if (url && !durationField.value) {
        const audio = new Audio(url);
        audio.addEventListener('loadedmetadata', function() {
            if (audio.duration && audio.duration !== Infinity) {
                durationField.value = Math.round(audio.duration);
            }
        });
    }
});
</script>

{% endblock %}
